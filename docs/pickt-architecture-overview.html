<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pick't Review Intelligence - Architecture Overview</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: #1a1a2e;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 40px;
      background: white;
    }
    
    @media print {
      body {
        padding: 20px;
        font-size: 11px;
      }
      .page-break {
        page-break-before: always;
      }
      h1 { font-size: 24px; }
      h2 { font-size: 18px; }
      h3 { font-size: 14px; }
    }
    
    h1 {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 8px;
      border-bottom: 3px solid #f97316;
      padding-bottom: 12px;
    }
    
    .subtitle {
      font-size: 18px;
      color: #64748b;
      margin-bottom: 32px;
    }
    
    h2 {
      font-size: 22px;
      font-weight: 600;
      color: #1a1a2e;
      margin-top: 32px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    h3 {
      font-size: 16px;
      font-weight: 600;
      color: #334155;
      margin-top: 24px;
      margin-bottom: 12px;
    }
    
    p {
      margin-bottom: 12px;
      color: #475569;
    }
    
    .flow-diagram {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      white-space: pre;
      overflow-x: auto;
      line-height: 1.4;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 14px;
    }
    
    th {
      background: #f1f5f9;
      font-weight: 600;
      text-align: left;
      padding: 12px 16px;
      border: 1px solid #e2e8f0;
    }
    
    td {
      padding: 10px 16px;
      border: 1px solid #e2e8f0;
      vertical-align: top;
    }
    
    tr:nth-child(even) {
      background: #f8fafc;
    }
    
    .stage-box {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      border-left: 4px solid #f97316;
      border-radius: 8px;
      padding: 20px;
      margin: 16px 0;
    }
    
    .stage-box h3 {
      margin-top: 0;
      color: #f97316;
    }
    
    .formula {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px 24px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 13px;
      margin: 16px 0;
      overflow-x: auto;
      white-space: pre-wrap;
      line-height: 1.8;
    }
    
    .formula strong {
      color: #fbbf24;
    }
    
    .highlight {
      background: #fef3c7;
      padding: 2px 6px;
      border-radius: 4px;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .badge-ai {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .badge-no-ai {
      background: #dcfce7;
      color: #166534;
    }
    
    .key-points {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 20px;
      margin: 24px 0;
    }
    
    .key-points h3 {
      color: #b45309;
      margin-top: 0;
    }
    
    .key-points ul {
      margin-left: 20px;
    }
    
    .key-points li {
      margin-bottom: 8px;
      color: #78350f;
    }
    
    ul, ol {
      margin-left: 24px;
      margin-bottom: 16px;
    }
    
    li {
      margin-bottom: 6px;
    }
    
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
    }
    
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 16px 0;
    }
    
    @media print {
      .two-col {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .col-box {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
    }
    
    .severity-critical { color: #dc2626; font-weight: 600; }
    .severity-high { color: #ea580c; font-weight: 600; }
    .severity-medium { color: #ca8a04; font-weight: 600; }
    .severity-low { color: #16a34a; font-weight: 600; }
    
    footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e2e8f0;
      color: #94a3b8;
      font-size: 12px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>Pick't Review Intelligence</h1>
<p class="subtitle">Technical Architecture Overview</p>

<h2>Executive Summary</h2>
<p>Pick't transforms thousands of customer reviews into actionable business intelligence through a five-stage pipeline. The system uses AI strategically—only where it adds value—while keeping scoring transparent and auditable.</p>

<div class="key-points">
  <h3>Key Takeaways</h3>
  <ul>
    <li><strong>AI is used surgically</strong> — Only for sentiment analysis, not for theme detection or scoring calculations</li>
    <li><strong>Cost efficient</strong> — Uses GPT-4o-mini (~$0.01 per 100 reviews)</li>
    <li><strong>Transparent scoring</strong> — Formula-based and auditable, not a black box</li>
    <li><strong>Actionable output</strong> — Automatically generates prioritized recommendations with suggested actions</li>
    <li><strong>Time-weighted</strong> — Recent reviews have more impact than older ones</li>
  </ul>
</div>

<h2>High-Level Data Flow</h2>

<div class="flow-diagram">┌──────────────────┐     ┌──────────────────┐     ┌──────────────────┐
│   DATA SOURCE    │     │    INGESTION     │     │    DATABASE      │
│   (Outscraper)   │────▶│    SERVICE       │────▶│    (Reviews)     │
│                  │     │                  │     │                  │
│  • JSON export   │     │  • Parse JSON    │     │  • Raw content   │
│  • 2,000+ reviews│     │  • Normalize     │     │  • Rating        │
│  • Rich metadata │     │  • Deduplicate   │     │  • Author info   │
└──────────────────┘     └──────────────────┘     └──────────────────┘
                                                           │
                                                           ▼
                              ┌─────────────────────────────────────────┐
                              │          SCORING PIPELINE               │
                              │     (Triggered by "Run Scoring")        │
                              ├─────────────────────────────────────────┤
                              │  Phase 1: Theme Extraction (Keywords)   │
                              │  Phase 2: Sentiment Analysis (OpenAI)   │
                              │  Phase 3: Theme Aggregation (Math)      │
                              │  Phase 4: Recommendations (Rules)       │
                              └─────────────────────────────────────────┘
                                                           │
                                                           ▼
                              ┌─────────────────────────────────────────┐
                              │         DASHBOARD & INSIGHTS            │
                              │  • Theme scores (0-10)                  │
                              │  • Prioritized recommendations          │
                              │  • Drill-down to actual reviews         │
                              └─────────────────────────────────────────┘</div>

<div class="page-break"></div>

<h2>The Five Stages Explained</h2>

<div class="stage-box">
  <h3>Stage 1: Data Ingestion <span class="badge badge-no-ai">No AI</span></h3>
  <p>Restaurant uploads an Outscraper JSON file containing Google reviews via the Data Sources page.</p>
  <table>
    <tr>
      <th>Input</th>
      <th>Process</th>
      <th>Output</th>
    </tr>
    <tr>
      <td>JSON file with reviews</td>
      <td>Parse → Normalize → Deduplicate</td>
      <td>Review records in database</td>
    </tr>
  </table>
  <p><strong>Key data extracted:</strong> Review text, star rating, date, author name/ID, structured ratings (Food/Service/Atmosphere), owner responses</p>
</div>

<div class="stage-box">
  <h3>Stage 2: Theme Extraction <span class="badge badge-no-ai">No AI — Keyword Matching</span></h3>
  <p>System scans review text for keywords that indicate themes.</p>
  <table>
    <tr>
      <th>Theme</th>
      <th>Example Keywords</th>
    </tr>
    <tr>
      <td>Food Quality</td>
      <td>"delicious", "bland", "fresh", "stale", "tasty"</td>
    </tr>
    <tr>
      <td>Service</td>
      <td>"friendly", "rude", "attentive", "ignored", "helpful"</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>"expensive", "worth it", "overpriced", "bargain"</td>
    </tr>
    <tr>
      <td>Cleanliness</td>
      <td>"dirty", "spotless", "hygiene", "filthy", "clean"</td>
    </tr>
    <tr>
      <td>Wait Time</td>
      <td>"slow", "quick", "waited forever", "prompt"</td>
    </tr>
    <tr>
      <td>Ambiance</td>
      <td>"cozy", "noisy", "romantic", "crowded", "atmosphere"</td>
    </tr>
  </table>
</div>

<div class="stage-box">
  <h3>Stage 3: Sentiment Scoring <span class="badge badge-ai">AI Engaged (OpenAI)</span></h3>
  <p>OpenAI analyzes each review's sentiment using GPT-4o-mini.</p>
  
  <h4>System Prompt (sent to OpenAI)</h4>
  <div class="formula" style="font-size: 11px; line-height: 1.6;">You are a sentiment analysis expert for restaurant reviews.
Analyze the sentiment of the review and extract themes.

Return a JSON object with this exact structure:
{
  "score": &lt;number between -1 (very negative) and +1 (very positive)&gt;,
  "confidence": &lt;number between 0 and 1&gt;,
  "category": &lt;"positive" | "neutral" | "negative"&gt;,
  "themes": [...]
}

Guidelines:
- Score -1 to -0.3 = negative, -0.3 to 0.3 = neutral, 0.3 to 1 = positive
- Only include themes that are clearly mentioned in the review
- Be precise with sentiment scores based on the intensity of the language</div>

  <h4>Example Request → Response</h4>
  <div class="two-col">
    <div class="col-box">
      <strong>User Prompt:</strong>
      <p style="font-size: 12px; margin-top: 8px; font-style: italic;">"The food was amazing but we waited 45 minutes for our table. Staff were friendly though."</p>
      <p style="font-size: 12px; color: #64748b;">Star rating: 3/5</p>
    </div>
    <div class="col-box">
      <strong>AI Response (JSON):</strong>
      <pre style="font-size: 11px; margin-top: 8px; background: #f1f5f9; padding: 8px; border-radius: 4px; overflow-x: auto;">{
  "score": 0.15,
  "confidence": 0.85,
  "category": "neutral",
  "themes": [
    { "name": "Food Quality",
      "sentiment": "positive" },
    { "name": "Wait Time",
      "sentiment": "negative" },
    { "name": "Service",
      "sentiment": "positive" }
  ]
}</pre>
    </div>
  </div>
  
  <h4>Weighted Impact Formula</h4>
  <div class="formula"><strong>W_r = Sentiment × Time_Decay × Source_Weight × Engagement_Boost</strong>

Where:
  • Time_Decay = e^(-0.012 × days_old)    → Recent reviews count more
  • Source_Weight = 1.2 for Google        → Platform credibility factor
  • Engagement_Boost = log(1 + likes)     → Popular reviews count more</div>
</div>

<div class="page-break"></div>

<div class="stage-box">
  <h3>Stage 4: Theme Aggregation <span class="badge badge-no-ai">No AI — Mathematical Formula</span></h3>
  <p>System calculates a 0-10 score for each theme based on all reviews mentioning it.</p>
  
  <div class="formula"><strong>Theme Score = 5 × (Σ W_r / Σ |W_r|) + 5</strong>

Example for "Value" theme with 121 mentions:

  Each review has a Weighted Impact (W_r) based on sentiment, recency, source, engagement.

  • 80 positive mentions × avg W_r of +0.60 = <strong>+48.0</strong>
  • 25 neutral mentions  × avg W_r of +0.10 = <strong>+2.5</strong>
  • 16 negative mentions × avg W_r of -0.70 = <strong>-11.2</strong>
                                              ───────
  Sum of W_r      = 48.0 + 2.5 + (-11.2)    = +39.3
  Sum of |W_r|    = 48.0 + 2.5 + 11.2       =  61.7

Final Calculation:
  Theme Sentiment = Σ W_r / Σ |W_r| = 39.3 / 61.7 = 0.64
  Theme Score     = 5 × (0.64 + 1) = <strong>8.2 / 10</strong></div>
</div>

<div class="stage-box">
  <h3>Stage 5: Recommendation Generation <span class="badge badge-no-ai">No AI — Templates</span></h3>
  <p>System flags themes needing attention based on score thresholds and mention volume.</p>
  
  <table>
    <tr>
      <th>Severity</th>
      <th>Score Threshold</th>
      <th>Min Non-Positive Mentions</th>
    </tr>
    <tr>
      <td><span class="severity-critical">CRITICAL</span></td>
      <td>&lt; 5.0</td>
      <td>10+</td>
    </tr>
    <tr>
      <td><span class="severity-high">HIGH</span></td>
      <td>&lt; 6.5</td>
      <td>5+</td>
    </tr>
    <tr>
      <td><span class="severity-medium">MEDIUM</span></td>
      <td>&lt; 7.5</td>
      <td>3+</td>
    </tr>
    <tr>
      <td><span class="severity-low">LOW</span></td>
      <td>&lt; 8.5</td>
      <td>2+</td>
    </tr>
  </table>
  
  <h4>How Recommendation Text is Generated</h4>
  <p>All recommendation text comes from <strong>pre-defined templates</strong>, not AI:</p>
  <ul>
    <li><strong>Title:</strong> Pattern like <code>"Urgent: Address Critical {Theme} Issues"</code> based on severity level</li>
    <li><strong>Description:</strong> Template filled with actual score and mention count data</li>
    <li><strong>Suggested Actions:</strong> From curated action lists per category (e.g., Value actions include "Analyze competitor pricing", "Design value-focused menu options")</li>
  </ul>
  
  <h4>How Tasks are Created</h4>
  <p>Tasks are <strong>not auto-generated</strong> — they require manual user action:</p>
  <ol>
    <li>User clicks "Create Task" on a recommendation</li>
    <li>Dialog shows the suggested actions (from templates) as checkboxes</li>
    <li>User <strong>selects which actions</strong> to turn into tasks</li>
    <li>User assigns a due date and team member</li>
    <li>Selected actions become trackable tasks</li>
  </ol>
  <p>This keeps the human in control — the system suggests, the manager decides.</p>
  
  <p><strong>Note:</strong> Only negative + neutral reviews count toward recommendations. Positive reviews are excluded since they don't indicate issues.</p>
</div>

<h2>Database Schema Overview</h2>

<div class="flow-diagram">┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Review    │────▶│ ReviewTheme │◀────│    Theme    │
│             │     │             │     │             │
│ • content   │     │ • sentiment │     │ • name      │
│ • rating    │     │ • confidence│     │ • category  │
│ • date      │     │ • keywords  │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
      │                                       │
      ▼                                       ▼
┌─────────────┐                        ┌─────────────┐
│ ReviewScore │                        │ ThemeScore  │
│             │                        │             │
│ • sentiment │                        │ • score010  │
│ • W_r       │                        │ • mentions  │
│ • components│                        │ • severity  │
└─────────────┘                        └─────────────┘
                                             │
                                             ▼
                                      ┌──────────────┐
                                      │Recommendation│
                                      │              │
                                      │ • title      │
                                      │ • actions    │
                                      │ • severity   │
                                      └──────────────┘</div>

<h2>Cost & Performance</h2>

<table>
  <tr>
    <th>Metric</th>
    <th>Value</th>
  </tr>
  <tr>
    <td>AI Model Used</td>
    <td>GPT-4o-mini (OpenAI's most cost-effective model)</td>
  </tr>
  <tr>
    <td>Cost per 100 reviews</td>
    <td>~$0.01 USD</td>
  </tr>
  <tr>
    <td>Processing speed</td>
    <td>~500 reviews/minute</td>
  </tr>
  <tr>
    <td>AI usage</td>
    <td>Only Phase 3 (Sentiment) — all other phases are deterministic</td>
  </tr>
</table>

<footer>
  <p>Pick't Review Intelligence Platform — Architecture Documentation</p>
  <p>Generated: January 2026</p>
</footer>

</body>
</html>
